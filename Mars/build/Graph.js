"use strict";var _slicedToArray=(function(){function sliceIterator(arr,i){var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n = (_s = _i.next()).done);_n = true) {_arr.push(_s.value);if(i && _arr.length === i)break;}}catch(err) {_d = true;_e = err;}finally {try{if(!_n && _i["return"])_i["return"]();}finally {if(_d)throw _e;}}return _arr;}return function(arr,i){if(Array.isArray(arr)){return arr;}else if(Symbol.iterator in Object(arr)){return sliceIterator(arr,i);}else {throw new TypeError("Invalid attempt to destructure non-iterable instance");}};})();var _createClass=(function(){function defineProperties(target,props){for(var i=0;i < props.length;i++) {var descriptor=props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if("value" in descriptor)descriptor.writable = true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};})();function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return call && (typeof call === "object" || typeof call === "function")?call:self;}function _inherits(subClass,superClass){if(typeof superClass !== "function" && superClass !== null){throw new TypeError("Super expression must either be null or a function, not " + typeof superClass);}subClass.prototype = Object.create(superClass && superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__ = superClass;}function _typeof(obj){return obj && typeof Symbol !== "undefined" && obj.constructor === Symbol?"symbol":typeof obj;}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}var Graph=(function(){var _=require("./underscore-extended.js");var UIDGenerator=require("./UIDGenerator");var CALLBACK_UID_KEY="_mars_graph_callback_uid";var CHANGE_UID_PREFIX="mars_graph_change_uid_";var uidGenerator=new UIDGenerator({sequenceLength:30});var GraphObject=(function(){function GraphObject(_ref){var _ref$data=_ref.data;var data=_ref$data === undefined?{}:_ref$data;var _ref$listen=_ref.listen;var listen=_ref$listen === undefined?{}:_ref$listen;var _ref$verify=_ref.verify;var verify=_ref$verify === undefined?{}:_ref$verify;var _ref$change=_ref.change;var change=_ref$change === undefined?{}:_ref$change;_classCallCheck(this,GraphObject);this._listeners = {};this._data = {};this._checks = {};this._dataListeners = {};for(var evt in listen) {if(listen.hasOwnProperty(evt)){this.on(evt,listen[evt]);}}this.data(data);this.verify(verify);this.process(change);}_createClass(GraphObject,[{key:"_callbackify",value:function _callbackify(callback){if(typeof callback === "function"){if(!callback[CALLBACK_UID_KEY]){callback[CALLBACK_UID_KEY] = uidGenerator.generate();}}else if(callback.constructor === Array){callback.map(function(fn){if(!fn[CALLBACK_UID_KEY]){fn[CALLBACK_UID_KEY] = uidGenerator.generate();}});}} /*
         Description:
            Adds one or more event listeners to this object
         Usage:
            on(event, callback)
                Adds `callback` as a listener for the `event` event
            on(event, callbacks)
                Adds all methods within the `callbacks` array as listeners
                for the `event` event
            on(json)
                Uses a `json` object where the keys are event names and the
                values are event listeners (or arrays of listeners) and Adds
                them
         */},{key:"on",value:function on(){for(var _len=arguments.length,args=Array(_len),_key=0;_key < _len;_key++) {args[_key] = arguments[_key];}if(args.length === 1){return this._onJSON.apply(this,args);}if(args.length >= 2){return this._onEvtCallback.apply(this,args);}return this;}},{key:"_onJSON",value:function _onJSON(json){if((typeof json === "undefined"?"undefined":_typeof(json)) !== "object"){return this;}for(var evt in json) {if(json.hasOwnProperty(evt)){this._onEvtCallback(evt,json[evt]);}}return this;}},{key:"_onEvtCallback",value:function _onEvtCallback(evt,callback){if(typeof evt !== "string" || typeof callback !== "function" && callback.constructor !== Array){return this;}if(typeof this._listeners[evt] === "undefined" || this._listeners[evt].constructor !== Array){this._listeners[evt] = [];}if(typeof callback === "function"){callback[CALLBACK_UID_KEY] = uidGenerator.generate();this._listeners[evt].push(callback);}else if(callback.constructor === Array){var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=callback[Symbol.iterator](),_step;!(_iteratorNormalCompletion = (_step = _iterator.next()).done);_iteratorNormalCompletion = true) {var listener=_step.value;this._onEvtCallback(evt,listener);}}catch(err) {_didIteratorError = true;_iteratorError = err;}finally {try{if(!_iteratorNormalCompletion && _iterator.return){_iterator.return();}}finally {if(_didIteratorError){throw _iteratorError;}}}}return this;} /*
         Description:
            Unbinds one or more event listeners from an object
         Usage:
            off(event, listener)
                Removes the listener on the `event` event matching `listener`
                (if any)
            off(event, listeners)
                Unbinds all listeners within the `listeners` array from the
                `event` event
            off(json)
                Uses a JSON object where the keys are event names and the values
                are event listeners (or groups of them) and remove all listeners
                from their respective events
         */},{key:"off",value:function off(){for(var _len2=arguments.length,args=Array(_len2),_key2=0;_key2 < _len2;_key2++) {args[_key2] = arguments[_key2];}if(args.length === 1){return this._offJSON.apply(this,args);}if(args.length >= 2){return this._offEvtCallback.apply(this,args);}return this;}},{key:"_offJSON",value:function _offJSON(json){if((typeof json === "undefined"?"undefined":_typeof(json)) !== "object"){return this;}for(var evt in json) {if(json.hasOwnProperty(evt)){this._offEvtCallback(evt,json[evt]);}}return this;}},{key:"_offEvtCallback",value:function _offEvtCallback(evt,callback){var _this=this;if(this._listeners[evt] === undefined){return this;}if(typeof callback === "function"){var _ret=(function(){if(!callback[CALLBACK_UID_KEY]){return {v:_this};}var callbackUid=callback[CALLBACK_UID_KEY];var filtered=_this._listeners[evt].filter(function(val){return val[CALLBACK_UID_KEY] !== callbackUid;});if(!filtered.length){delete _this._listeners[evt];}else {_this._listeners[evt] = filtered;}})();if((typeof _ret === "undefined"?"undefined":_typeof(_ret)) === "object")return _ret.v;}else if(callback.constructor === Array){var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=callback[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done);_iteratorNormalCompletion2 = true) {var listener=_step2.value;this._offEvtCallback(evt,listener);}}catch(err) {_didIteratorError2 = true;_iteratorError2 = err;}finally {try{if(!_iteratorNormalCompletion2 && _iterator2.return){_iterator2.return();}}finally {if(_didIteratorError2){throw _iteratorError2;}}}}return this;} /*
         Description:
            Fires one or more events with optional data
         Usage:
            fire(event, data)
                Fires the `event` event passing the `data` object to it
            fire(events, data)
                Fires all events in `events` passing the data object to them
            fire(json)
                `json` is a JSON object containing the names of events as keys
                and the data to pass to them when fired as values
         */},{key:"fire",value:function fire(){for(var _len3=arguments.length,args=Array(_len3),_key3=0;_key3 < _len3;_key3++) {args[_key3] = arguments[_key3];}if(!args.length){return this;}if(args.length === 1 && _typeof(args[0]) === "object" && args[0].constructor !== Array){return this._fireJSON.apply(this,args);}if(args[0].constructor === Array){return this._fireEvents.apply(this,args);}if(typeof args[0] === "string"){return this._fireEvent.apply(this,args);}return this;}},{key:"_fireJSON",value:function _fireJSON(json){for(var eventName in json) {if(json.hasOwnProperty(eventName)){this._fireEvent(eventName,json[eventName]);}}return this;}},{key:"_fireEvents",value:function _fireEvents(eventNames,data){var _iteratorNormalCompletion3=true;var _didIteratorError3=false;var _iteratorError3=undefined;try{for(var _iterator3=eventNames[Symbol.iterator](),_step3;!(_iteratorNormalCompletion3 = (_step3 = _iterator3.next()).done);_iteratorNormalCompletion3 = true) {var eventName=_step3.value;this._fireEvent(eventName,data);}}catch(err) {_didIteratorError3 = true;_iteratorError3 = err;}finally {try{if(!_iteratorNormalCompletion3 && _iterator3.return){_iterator3.return();}}finally {if(_didIteratorError3){throw _iteratorError3;}}}return this;}},{key:"_fireEvent",value:function _fireEvent(eventName,data){if(this._listeners.hasOwnProperty(eventName)){var _iteratorNormalCompletion4=true;var _didIteratorError4=false;var _iteratorError4=undefined;try{for(var _iterator4=this._listeners[eventName][Symbol.iterator](),_step4;!(_iteratorNormalCompletion4 = (_step4 = _iterator4.next()).done);_iteratorNormalCompletion4 = true) {var listener=_step4.value;listener(data);}}catch(err) {_didIteratorError4 = true;_iteratorError4 = err;}finally {try{if(!_iteratorNormalCompletion4 && _iterator4.return){_iterator4.return();}}finally {if(_didIteratorError4){throw _iteratorError4;}}}}return this;}},{key:"data",value:function data(){if(arguments.length === 1){var dat=arguments[0];this._data = _.merge(this._data,dat);}else if(arguments.length >= 2){var _arguments=arguments;var _arguments2=_slicedToArray(_arguments,2);var key=_arguments2[0];var value=_arguments2[1];key = key.split(".");var ref=this._data;while(key.length > 1 && ref !== undefined) {ref = ref[key.shift()];}if(ref !== undefined){ref[key.shift()] = value;}}return this._data;}},{key:"process",value:function process(){for(var _len4=arguments.length,args=Array(_len4),_key4=0;_key4 < _len4;_key4++) {args[_key4] = arguments[_key4];}if(args.length === 1){this._processJSON.apply(this,args);}else if(args.length === 2){this._processKeyValue.apply(this,args);}return this;}},{key:"_processJSON",value:function _processJSON(json){var path=arguments.length <= 1 || arguments[1] === undefined?"":arguments[1];for(var key in json) {if(json.hasOwnProperty(key)){var valPath=path;if(valPath.length){valPath += ".";}valPath += key;if(_.isFunction(json[key]) || _.isArray(json[key])){this._processKeyValue(valPath,json[key]);}else if(_.isObject(json[key])){this._processJSON(json[key],valPath);}}}}},{key:"_processKeyValue",value:function _processKeyValue(key,listeners){if(typeof key !== "string"){return this;}if(listeners.constructor !== Array){listeners = [listeners];}listeners = listeners.filter(function(val){return _.isFunction(val);});var path=key;var setKey="" + CHANGE_UID_PREFIX + path + "_set";var getKey="" + CHANGE_UID_PREFIX + path + "_get";var verifyKey="" + CHANGE_UID_PREFIX + path + "_verify";if(this._checks[verifyKey] === undefined){this._checks[verifyKey] = [];}if(this._checks[getKey] === undefined){this._checks[getKey] = [];}if(this._dataListeners[setKey] !== undefined){this._dataListeners[setKey].push.apply(this._dataListeners[setKey],listeners);}else {this._dataListeners[setKey] = listeners;key = key.split(".");var ref=this._data;while(key.length > 1 && ref !== undefined) {ref = ref[key.shift()];}if(ref !== undefined){key = key.shift();this._attachAccessors(ref,key,path,[getKey,setKey,verifyKey]);}}}},{key:"_attachAccessors",value:function _attachAccessors(ref,key,path,_ref2){var _ref3=_slicedToArray(_ref2,3);var getKey=_ref3[0];var setKey=_ref3[1];var verifyKey=_ref3[2];var val=ref[key];Object.defineProperty(ref,key,{set:(function(nVal){if(this._checks[verifyKey] !== undefined){var _iteratorNormalCompletion5=true;var _didIteratorError5=false;var _iteratorError5=undefined;try{for(var _iterator5=this._checks[verifyKey][Symbol.iterator](),_step5;!(_iteratorNormalCompletion5 = (_step5 = _iterator5.next()).done);_iteratorNormalCompletion5 = true) {var check=_step5.value;if(!check(nVal)){return;}}}catch(err) {_didIteratorError5 = true;_iteratorError5 = err;}finally {try{if(!_iteratorNormalCompletion5 && _iterator5.return){_iterator5.return();}}finally {if(_didIteratorError5){throw _iteratorError5;}}}}if(this._dataListeners[setKey] !== undefined){var _iteratorNormalCompletion6=true;var _didIteratorError6=false;var _iteratorError6=undefined;try{for(var _iterator6=this._dataListeners[setKey][Symbol.iterator](),_step6;!(_iteratorNormalCompletion6 = (_step6 = _iterator6.next()).done);_iteratorNormalCompletion6 = true) {var processor=_step6.value;var possible=processor(nVal);if(possible !== undefined){nVal = possible;}}}catch(err) {_didIteratorError6 = true;_iteratorError6 = err;}finally {try{if(!_iteratorNormalCompletion6 && _iterator6.return){_iterator6.return();}}finally {if(_didIteratorError6){throw _iteratorError6;}}}}val = nVal;}).bind(this),get:(function(){var retVal=val;if(this._dataListeners[getKey] !== undefined){var _iteratorNormalCompletion7=true;var _didIteratorError7=false;var _iteratorError7=undefined;try{for(var _iterator7=this._dataListeners[getKey][Symbol.iterator](),_step7;!(_iteratorNormalCompletion7 = (_step7 = _iterator7.next()).done);_iteratorNormalCompletion7 = true) {fetcher = _step7.value;retVal = fetchers(val);}}catch(err) {_didIteratorError7 = true;_iteratorError7 = err;}finally {try{if(!_iteratorNormalCompletion7 && _iterator7.return){_iterator7.return();}}finally {if(_didIteratorError7){throw _iteratorError7;}}}}return retVal;}).bind(this)});}},{key:"fetch",value:function fetch(){}},{key:"processSet",value:function processSet(){}},{key:"verify",value:function verify(checks){_.mapObject(checks,function(value,key){});return this;}}]);return GraphObject;})();var Graph=(function(_GraphObject){_inherits(Graph,_GraphObject);function Graph(){var cfg=arguments.length <= 0 || arguments[0] === undefined?{}:arguments[0];_classCallCheck(this,Graph);return _possibleConstructorReturn(this,Object.getPrototypeOf(Graph).call(this,cfg));}return Graph;})(GraphObject);var Node=(function(_GraphObject2){_inherits(Node,_GraphObject2);function Node(){var cfg=arguments.length <= 0 || arguments[0] === undefined?{}:arguments[0];_classCallCheck(this,Node);return _possibleConstructorReturn(this,Object.getPrototypeOf(Node).call(this,cfg));}return Node;})(GraphObject);var Edge=(function(_GraphObject3){_inherits(Edge,_GraphObject3);function Edge(){var cfg=arguments.length <= 0 || arguments[0] === undefined?{}:arguments[0];_classCallCheck(this,Edge);return _possibleConstructorReturn(this,Object.getPrototypeOf(Edge).call(this,cfg));}_createClass(Edge,[{key:"connect",value:function connect(){}},{key:"unconnect",value:function unconnect(){}}]);return Edge;})(GraphObject);Graph.Node = Node;Graph.Edge = Edge;module.exports = Graph;return Graph;})();